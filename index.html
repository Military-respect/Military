<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุงูุฅุฏุงุฑุฉ ุงูุนุณูุฑูุฉ</title>
    <!-- Google Fonts: Cairo for a modern Arabic look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <!-- Landing Page Overlay -->
    <div id="landingPage" class="landing-page">
        <div class="landing-content">
            <h1 class="landing-title">ูุธุงู ุงูุฅุฏุงุฑุฉ ุงูุนุณูุฑูุฉ</h1>
            <div class="landing-cards">
                <!-- Recruitment Card -->
                <div id="landingRecruitBtn" class="landing-card" onclick="openRecruitmentFromLanding()">
                    <i class="fa-solid fa-file-signature big-icon"></i>
                    <h2>ุงูุชูุฏูู</h2>
                    <p id="landingRecruitStatus">ุชุญูู ูู ุงูุญุงูุฉ...</p>
                </div>

                <!-- View Army Card -->
                <div class="landing-card" onclick="enterSite()">
                    <i class="fa-solid fa-users-viewfinder big-icon"></i>
                    <h2>ุฑุคูุฉ ุงูุฌูุด</h2>
                    <p>ุนุฑุถ ุงูููููุฉ ูุงูุฃุนุถุงุก</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Wrapper (Hidden initially via script or staying behind z-index) -->
    <div id="mainAppWrapper" class="hidden-initially">
        <header class="main-header">
            <div class="logo-area">
                <h1><i class="fa-solid fa-shield-halved"></i> ูุธุงู ุงูููููุฉ ุงูุนุณูุฑูุฉ</h1>
            </div>

            <!-- New Info Nav -->
            <div class="info-nav">
                <button onclick="openInfoModal('rules')"><i class="fa-solid fa-scale-balanced"></i> ุงูููุงููู</button>
                <button onclick="openInfoModal('reporting')"><i class="fa-solid fa-bullhorn"></i> ุงูุชุจููุบ</button>
                <button onclick="openInfoModal('strategies')"><i class="fa-solid fa-chess"></i> ุงุณุชุฑุงุชูุฌูุงุช</button>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ุจุญุซ ุนู ุดุฎุต ุจุงูุงุณู..." onkeyup="searchPersonnel()">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
            </div>

            <div class="admin-controls">
                <!-- Admin Toggle -->
                <button id="adminBtn" onclick="toggleAdminPanel()"><i class="fa-solid fa-user-shield"></i> ูุดุฑู</button>

                <!-- Login Panel -->
                <div id="adminPanel" class="hidden">
                    <input type="password" id="adminPin" placeholder="ุฃุฏุฎู ุฑูุฒ ุงููุดุฑู">
                    <button onclick="checkAdminPin()">ุฏุฎูู</button>
                </div>

                <!-- Admin Toolbar (Visible only when logged in) -->
                <div id="adminTools" class="hidden" style="display:flex; gap:5px;">
                    <button onclick="toggleRecruitmentStatus()" id="toggleRecruitBtn"
                        style="background:var(--secondary-color);">
                        <i class="fa-solid fa-lock"></i> ูุชุญ ุงูุชูุฏูู
                    </button>
                    <button onclick="openApplicationsModal()" style="background:var(--secondary-color);">
                        <i class="fa-solid fa-list-ul"></i> ุงูุชูุฏููุงุช (<span id="appCount">0</span>)
                    </button>
                    <button id="logoutBtn" onclick="logoutAdmin()">ุชุณุฌูู ุฎุฑูุฌ <i
                            class="fa-solid fa-right-from-bracket"></i></button>
                </div>
            </div>
        </header>

        <div id="statusMessage" class="status-message hidden"></div>

        <main class="container">
            <!-- Ranks will be generated here -->
            <div id="ranksContainer" class="ranks-grid"></div>

            <!-- Add Rank Button (Admin Only) -->
            <div id="addRankContainer" class="add-rank-container hidden">
                <button onclick="openAddRankModal()" class="add-rank-btn"><i class="fa-solid fa-plus"></i> ุฅุถุงูุฉ ุฑุชุจุฉ
                    ุฌุฏูุฏุฉ</button>
            </div>
        </main>
    </div>

    <!-- Modal: Recruitment Form (Public) -->
    <div id="recruitmentModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('recruitmentModal')">&times;</span>
            <h2><i class="fa-solid fa-file-contract"></i> ุชูุฏูู ุทูุจ ุงูุชุญุงู</h2>
            <form id="recruitmentForm" onsubmit="submitApplication(event)">
                <div class="recruitment-form-group">
                    <label>ุงุณูู ุจุฑูู (Roleplay Name):</label>
                    <input type="text" id="appRealName" required>
                </div>
                <div class="recruitment-form-group">
                    <label>ุงูุนูุฑ:</label>
                    <input type="number" id="appAge" required>
                </div>
                <div class="recruitment-form-group">
                    <label>ุขูุฏู ุงูุฏูุณููุฑุฏ (Discord ID):</label>
                    <input type="text" id="appDiscord" required>
                </div>
                <div class="recruitment-form-group">
                    <label>ูุง ุณุจุจ ุชูุฏููู ููุฌูุดุ</label>
                    <textarea id="appReason" required></textarea>
                </div>
                <div class="recruitment-form-group">
                    <label>ูุด ุจุชููุฏ ุงูุฌูุดุ</label>
                    <textarea id="appBenefit" required></textarea>
                </div>
                <div class="recruitment-form-group">
                    <label>ูุงูู ููุงู ุงูุฌูุดุ</label>
                    <textarea id="appTasks" required></textarea>
                </div>
                <div class="recruitment-form-group">
                    <label>ูุด ุงูุฃุดูุงุก ุงููู ุชุฎููู ูููุฒุ</label>
                    <textarea id="appUnique" required></textarea>
                </div>
                <div class="recruitment-form-group">
                    <label>ุชุนุฑูู ุนู ููุณู:</label>
                    <textarea id="appIntro" required></textarea>
                </div>
                <button type="submit" class="save-btn">ุฅุฑุณุงู ุงูุทูุจ</button>
            </form>
        </div>
    </div>

    <!-- Modal: Info Content (Rules, Strategies, etc) -->
    <div id="infoModal" class="modal hidden">
        <div class="modal-content" style="max-width:700px;">
            <span class="close-modal" onclick="closeModal('infoModal')">&times;</span>
            <h2 id="infoTitle">ุงูุนููุงู</h2>

            <div id="infoViewContent" class="info-text-content">
                <!-- Content goes here -->
            </div>

            <textarea id="infoEditContent" class="hidden"
                style="width:100%; height:300px; background:#333; color:white; padding:10px; margin-top:10px; font-family:'Cairo'; border:1px solid #555; resize: vertical;"></textarea>

            <div class="admin-only hidden" style="margin-top:15px; border-top:1px solid #555; padding-top:10px;">
                <button id="editInfoBtn" onclick="toggleEditInfoMode()"
                    style="background:var(--secondary-color);">ุชุนุฏูู</button>
                <button id="saveInfoBtn" onclick="saveInfoContent()" class="hidden"
                    style="background:var(--success);">ุญูุธ ุงูุชุบููุฑุงุช</button>
            </div>
        </div>
    </div>

    <!-- Modal: Applications View (Admin) -->
    <div id="applicationsModal" class="modal hidden">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <span class="close-modal" onclick="closeModal('applicationsModal')">&times;</span>
            <h2>ุทูุจุงุช ุงูุงูุชุญุงู ุงููุนููุฉ</h2>
            <div id="applicationsList"></div>
        </div>
    </div>

    <!-- Modal: Add/Edit Person -->
    <div id="personModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('personModal')">&times;</span>
            <h2 id="modalTitle">ุฅุถุงูุฉ ุดุฎุต</h2>
            <form id="personForm" onsubmit="handlePersonSubmit(event)">
                <input type="hidden" id="personId">
                <input type="hidden" id="personRankId">

                <div class="form-group">
                    <label>ุงูุฑูุฒ ุงูุนุณูุฑู (Code):</label>
                    <input type="text" id="personCode" placeholder="ุงุฎุชูุงุฑู">
                </div>

                <div class="form-group">
                    <label>ุงูุงุณู ุงููุงูู:</label>
                    <input type="text" id="personName" required>
                </div>

                <div class="form-group">
                    <label>ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ (ุฑุงุจุท ุฃู ุฑูุน):</label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="personImageFile" accept="image/*" onchange="handleImageUpload(this)">
                        <span class="or-divider">ุฃู</span>
                        <input type="url" id="personImageUrl" placeholder="ุฑุงุจุท ุงูุตูุฑุฉ ุงููุจุงุดุฑ">
                    </div>
                    <div class="image-preview" id="imagePreview"></div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="save-btn">ุญูุธ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Person Details (View) -->
    <div id="detailsModal" class="modal hidden">
        <div class="modal-content details-card">
            <span class="close-modal" onclick="closeModal('detailsModal')">&times;</span>
            <div class="person-header">
                <img id="detailImage" src="" alt="Person Image" class="detail-avatar">
                <div class="person-info-text">
                    <h2 id="detailName"></h2>
                    <p id="detailCode"
                        style="color:var(--accent-color); font-family:monospace; font-size:1.1rem; margin-top:5px;"></p>
                    <p id="detailRank" class="rank-badge"></p>

                    <div id="statusContainer" class="status-select-container hidden">
                        <label for="statusSelect" style="color:#aaa; font-size:0.9rem;">ุงูุญุงูุฉ: </label>
                        <select id="statusSelect" onchange="updatePersonStatus()">
                            <option value="active">๐ข ุญุงุถุฑ</option>
                            <option value="inactive">๐ด ุบุงุฆุจ</option>
                            <option value="vacation">๐ก ุฅุฌุงุฒุฉ</option>
                            <option value="mission">๐ต ูููุฉ</option>
                        </select>
                    </div>

                    <div id="warnsContainer"
                        style="margin-top: 10px; border: 1px solid #555; padding: 5px; border-radius: 5px; display: inline-block;">
                        <span style="color: var(--danger); font-weight: bold;"><i
                                class="fa-solid fa-triangle-exclamation"></i> ุงูุฅูุฐุงุฑุงุช: <span
                                id="detailWarns">0</span></span>
                        <div id="warnControls" class="admin-only hidden"
                            style="display: inline-flex; gap: 5px; margin-right: 10px;">
                            <button onclick="changeWarns(1)"
                                style="padding: 2px 8px; font-size: 0.8rem; background: var(--danger);">+</button>
                            <button onclick="changeWarns(-1)"
                                style="padding: 2px 8px; font-size: 0.8rem; background: var(--success);">-</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="details-section">
                <h3><i class="fa-solid fa-list-check"></i> ุงูููุงู</h3>
                <ul id="detailTasks" class="task-list"></ul>
                <div id="adminTaskControls" class="admin-only hidden">
                    <div class="add-item-row">
                        <input type="text" id="newTaskInput" placeholder="ูููุฉ ุฌุฏูุฏุฉ...">
                        <button onclick="addTask()"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
            </div>

            <div class="details-section">
                <h3><i class="fa-solid fa-medal"></i> ูุชุทูุจุงุช ุงูุชุฑููุฉ</h3>
                <ul id="detailPromotions" class="promotion-list"></ul>
                <div id="adminPromoControls" class="admin-only hidden">
                    <div class="add-item-row">
                        <input type="text" id="newPromoInput" placeholder="ูุชุทูุจ ุชุฑููุฉ ุฌุฏูุฏ...">
                        <button onclick="addPromo()"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
            </div>

            <div class="admin-only hidden"
                style="margin-top: 20px; text-align: center; display: flex; justify-content: center; gap: 10px;">
                <button onclick="editCurrentPerson()" class="save-btn"
                    style="width: auto; background-color: var(--secondary-color); color: white;">ุชุนุฏูู ุงูุจูุงูุงุช</button>
                <button onclick="deleteCurrentPerson()" class="delete-btn" style="width: auto;">ุญุฐู ุงูุดุฎุต</button>
            </div>
        </div>
    </div>

    <!-- Modal: Add Rank -->
    <div id="rankModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('rankModal')">&times;</span>
            <h2>ุฅุถุงูุฉ ุฑุชุจุฉ ุฌุฏูุฏุฉ</h2>
            <form onsubmit="handleRankSubmit(event)">
                <div class="form-group">
                    <label>ุงุณู ุงูุฑุชุจุฉ:</label>
                    <input type="text" id="rankName" required>
                </div>
                <div class="form-group">
                    <label>ุงูุชุฑุชูุจ (ุฑูู):</label>
                    <input type="number" id="rankOrder" required>
                </div>
                <button type="submit" class="save-btn">ุฅุถุงูุฉ</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs (Compat version) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script src="script.js"></script>
</body>

</html>